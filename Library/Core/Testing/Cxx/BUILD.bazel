# =============================================================================
# XSigma Core Library Tests BUILD Configuration
# =============================================================================
# Test targets for Core library using GoogleTest
# Equivalent to Library/Core/Testing/Cxx/CMakeLists.txt
# =============================================================================

load("//bazel:xsigma.bzl", "xsigma_copts", "xsigma_defines", "xsigma_linkopts")

package(default_visibility = ["//visibility:public"])

# =============================================================================
# Test Files
# =============================================================================

# Core test files (non-GPU, non-profiler specific)
_CORE_TEST_FILES = [
    "TestAllocatorBfc.cpp",
    "TestAllocatorPool.cpp",
    "TestAllocatorStatistics.cpp",
    "TestAllocatorTracking.cpp",
    "TestAsciiVisualizer.cpp",
    "TestBackTrace.cpp",
    "TestCPUMemory.cpp",
    "TestCPUMemoryStats.cpp",
    "TestCPUinfo.cpp",
    "TestException.cpp",
    "TestFlatHash.cpp",
    "TestHashUtil.cpp",
    "TestLazy.cpp",
    "TestLogger.cpp",
    "TestLoggerThreadName.cpp",
    "TestParallelApi.cpp",
    "TestParallelFor.cpp",
    "TestParallelGuard.cpp",
    "TestParallelReduce.cpp",
    "TestPointer.cpp",
    "TestProfiler.cpp",
    "TestProfilerAnalysis.cpp",
    "TestProfilerAnnotationParsing.cpp",
    "TestProfilerAnnotationStack.cpp",
    "TestProfilerBackendIntegration.cpp",
    "TestProfilerChromeTraceHierarchical.cpp",
    "TestProfilerExporters.cpp",
    "TestProfilerFormatUtils.cpp",
    "TestProfilerMemoryAndStats.cpp",
    "TestProfilerPlatform.cpp",
    "TestProfilerStatsCalculator.cpp",
    "TestProfilerTimespan.cpp",
    "TestProfilerUtils.cpp",
    "TestProfilerXPlane.cpp",
    "TestProfilerXPlaneVisitor.cpp",
    "TestSMP.cpp",
    "TestSMPComprehensive.cpp",
    "TestSMPEnhanced.cpp",
    "TestSMPTransformFillSort.cpp",
    "TestSanitizers.cpp",
    "TestScopedMemoryDebugAnnotation.cpp",
    "TestSmpAdvancedParallelThreadPoolNative.cpp",
    "TestSmpAdvancedThreadName.cpp",
    "TestSmpAdvancedThreadPool.cpp",
    "TestStringUtil.cpp",
    "TestThreadPool.cpp",
    "TestTraceme.cpp",
    "TestXPlaneBuilder.cpp",
    "TestXPlaneSchema.cpp",
    "TestXPlaneUtils.cpp",
    "TestXSigmaProfiler.cpp",
]

# =============================================================================
# Core Tests Target
# =============================================================================

cc_test(
    name = "CoreCxxTests",
    size = "large",
    timeout = "long",  # Increase timeout for profiler tests
    srcs = _CORE_TEST_FILES,
    copts = xsigma_copts(),
    defines = xsigma_defines() + [
        "XSIGMA_GOOGLE_TEST",
        "USE_GTEST",
        "_VARIADIC_MAX=10",
        "XSIGMA_HAS_GTEST=1",
        "XSIGMA_HAS_CUDA=0",
        "XSIGMA_HAS_HIP=0",
        "XSIGMA_HAS_KINETO=0",
    ],
    includes = ["."],
    linkopts = xsigma_linkopts(),
    deps = [
        "//Library/Core:Core",
        "//Library/Core/Testing:xsigmaTest_header",
        "@com_google_googletest//:gtest",
        "@com_google_googletest//:gtest_main",
    ],
)

