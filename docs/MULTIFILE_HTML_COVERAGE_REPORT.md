# Multi-File HTML Coverage Report

## Overview

The XSigma project now generates rich, multi-file HTML coverage reports that provide comprehensive code coverage analysis with an intuitive web-based interface.

## Report Structure

### 1. Index/Summary Page (`index.html`)

The main entry point provides:

- **Overall Coverage Statistics**
  - Overall coverage percentage
  - Total lines covered
  - Total lines uncovered
  - Total lines analyzed
  - Number of files analyzed

- **File Coverage Summary Table**
  - File path with clickable links to individual reports
  - Lines covered per file
  - Lines uncovered per file
  - Total lines per file
  - Coverage percentage per file (color-coded)
  - Files sorted by coverage percentage (worst first)

- **Visual Design**
  - Clean, professional layout
  - Color-coded coverage indicators
  - Responsive grid layout for statistics
  - Sortable file table

### 2. Individual File Reports

Each source file gets its own HTML report showing:

- **File Header**
  - File path
  - Coverage statistics (covered, uncovered, total, percentage)

- **Line-by-Line Coverage Visualization**
  - Line numbers
  - Coverage status indicator (✓ for covered, ✗ for uncovered)
  - Source code with syntax highlighting
  - Color-coded rows:
    - Green: Covered lines
    - Red: Uncovered lines
    - White: Non-executable lines

- **Navigation**
  - Back link to summary page
  - Easy navigation between files

## Report Location

### Primary Location (Clang/LLVM)
```
tools/code_coverage/profile/html_details/
├── index.html                    # Summary page
├── Core_Math_Vector.h.html       # Individual file reports
├── Core_Math_Matrix.h.html
├── Core_Util_Helper.cpp.html
└── ...
```

### Alternative Location (GCC)
```
tools/code_coverage/profile/html_report/
└── index.html                    # Generated by genhtml
```

## Generating Coverage Reports

### Build with Coverage (Clang)
```bash
cd Scripts
python setup.py ninja.clang.config.build.test.coverage
```

### Build with Coverage (GCC)
```bash
cd Scripts
python setup.py ninja.gcc.config.build.test.coverage
```

### Re-analyze Existing Coverage
```bash
cd Scripts
python setup.py analyze
```

## Viewing Reports

### Open in Browser

**Linux:**
```bash
xdg-open tools/code_coverage/profile/html_details/index.html
```

**macOS:**
```bash
open tools/code_coverage/profile/html_details/index.html
```

**Windows:**
```bash
start tools/code_coverage/profile/html_details/index.html
```

### Using Python HTTP Server
```bash
cd tools/code_coverage/profile/html_details
python -m http.server 8000
# Then open http://localhost:8000 in your browser
```

## Features

### Color-Coded Coverage Indicators

- **Excellent (≥80%)**: Green - High coverage
- **Good (60-79%)**: Orange - Acceptable coverage
- **Poor (<60%)**: Red - Needs improvement

### Interactive Navigation

- Click on file names in the summary to view detailed reports
- Click "Back to Summary" to return to the index page
- Hover effects for better usability

### Responsive Design

- Works on desktop and mobile browsers
- Readable on various screen sizes
- Professional styling with clear typography

## Implementation Details

### Generator Module

**File:** `Tools/code_coverage/package/tool/html_report_generator.py`

The `HtmlReportGenerator` class provides:

```python
class HtmlReportGenerator:
    def __init__(self, output_dir: str)
    def generate_report(
        self,
        covered_lines: Dict[str, Set[int]],
        uncovered_lines: Dict[str, Set[int]],
        source_root: str = "",
    ) -> None
```

### Integration Points

1. **summarize_jsons.py**: Calls `generate_multifile_html_report()` after parsing coverage data
2. **print_report.py**: Provides `generate_multifile_html_report()` function
3. **clang_coverage.py**: Provides `show_multifile_html()` function for direct HTML generation

## Coverage Data Flow

```
Coverage Collection
    ↓
Test Execution
    ↓
Profile Data Merge (Clang) / GCDA Collection (GCC)
    ↓
JSON Export
    ↓
Coverage Analysis & Statistics Calculation
    ↓
Multi-File HTML Report Generation
    ├── Index/Summary Page
    └── Individual File Reports
```

## Customization

### Output Directory

The default output directory is:
```
tools/code_coverage/profile/html_details/
```

To customize, modify the `output_dir` parameter in:
- `generate_multifile_html_report()` in `print_report.py`
- `show_multifile_html()` in `clang_coverage.py`

### Styling

HTML reports use inline CSS for portability. To customize styling, edit the CSS sections in:
- `HtmlReportGenerator._get_index_html()` - Index page styling
- `HtmlReportGenerator._get_file_html()` - File report styling

## Performance Considerations

- Report generation is fast (typically <1 second for 100+ files)
- HTML files are self-contained (no external dependencies)
- Reports can be archived and shared easily
- Suitable for CI/CD integration

## Troubleshooting

### Reports Not Generated

1. Verify coverage is enabled: `XSIGMA_ENABLE_COVERAGE=ON`
2. Check build directory exists
3. Verify tests ran successfully
4. Check for errors in build output

### Missing Source Code in File Reports

1. Ensure `source_root` parameter is set correctly
2. Verify source files exist at the specified paths
3. Check file permissions

### Styling Issues

1. Clear browser cache
2. Try a different browser
3. Check for CSS conflicts with browser extensions

## Examples

### Example Index Page Statistics

```
Overall Coverage: 85.42%
Lines Covered: 12,450
Lines Uncovered: 2,130
Total Lines: 14,580
Files Analyzed: 156
```

### Example File Report

```
File: Core/Math/Vector.h
Covered: 45
Uncovered: 5
Total: 50
Coverage: 90.00%

[Line-by-line visualization with color coding]
```

## Related Documentation

- [Code Coverage Quick Reference](COVERAGE_QUICK_REFERENCE.md)
- [Coverage Implementation Details](COVERAGE_IMPLEMENTATION_DETAILS.md)
- [Coverage Verification Guide](COVERAGE_VERIFICATION_GUIDE.md)

